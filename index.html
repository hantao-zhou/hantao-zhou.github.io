<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>System Core Test Terminal</title>
    <style>
      body {
        font-family: monospace;
        background-color: #1e1e1e;
        color: #d4d4d4;
        margin: 0;
        padding: 20px;
      }
      #terminal {
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
        border: 1px solid #333;
        padding: 10px;
        background-color: #262626;
        min-height: 400px;
        overflow-y: auto;
      }
      #output {
        white-space: pre-wrap;
        line-height: 1.4em;
      }
      #command-input {
        width: calc(100% - 20px);
        padding: 8px;
        margin-top: 10px;
        border: none;
        background-color: #333;
        color: #d4d4d4;
      }
      #command-input:focus {
        outline: none;
      }
    </style>
  </head>
  <body>
    <div id="terminal">
      <div id="output"></div>
      <input
        type="text"
        id="command-input"
        placeholder="Enter command here..."
        autofocus
      />
    </div>

    <!-- Include the kernel core -->
    <script src="kernel.js"></script>

    <!-- Terminal Command Parser and Handler -->
    <script>
      // Get references to DOM elements.
      const outputEl = document.getElementById("output");
      const inputEl = document.getElementById("command-input");

      // Print text to the terminal output area.
      function printOutput(text) {
        outputEl.innerText += text + "\n";
        outputEl.scrollTop = outputEl.scrollHeight;
      }

      // Display initial help message.
      printOutput("Welcome to the Test Terminal. Type 'help' for commands.");

      // Command parser: tokenizes input and calls appropriate kernel functions.
      function handleCommand(command) {
        const args = command.trim().split(" ");
        const cmd = args[0].toLowerCase();

        switch (cmd) {
          case "help":
            printOutput("Available commands:");
            printOutput("  help             - Show this help message.");
            printOutput(
              "  start [name]     - Start a process with the given name."
            );
            printOutput("  list             - List all running processes.");
            printOutput(
              "  broadcast [msg]  - Broadcast a message to all processes."
            );
            break;

          case "start":
            if (args.length < 2) {
              printOutput("Error: 'start' command requires a process name.");
            } else {
              const procName = args.slice(1).join(" ");
              const proc = kernel.startProcess(procName);
              printOutput(
                `Process started: PID ${proc.pid}, Name: ${proc.name}`
              );
            }
            break;

          case "list":
            const procs = kernel.listProcesses();
            if (procs.length === 0) {
              printOutput("No processes are currently running.");
            } else {
              printOutput("Running processes:");
              procs.forEach((proc) => {
                printOutput(`  PID ${proc.pid}: ${proc.name} [${proc.status}]`);
              });
            }
            break;

          case "broadcast":
            if (args.length < 2) {
              printOutput("Error: 'broadcast' command requires a message.");
            } else {
              const msg = args.slice(1).join(" ");
              kernel.broadcast(msg);
              printOutput(`Broadcasted message: "${msg}"`);
            }
            break;

          default:
            printOutput(`Unrecognized command: ${command}`);
        }
      }

      // Listen for Enter key events in the command input.
      inputEl.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
          const command = inputEl.value;
          printOutput("> " + command);
          handleCommand(command);
          inputEl.value = "";
        }
      });
    </script>
  </body>
</html>
